theory mpz_realloc2_Zrealloc2_wmpz_realloc2qtvc
  imports "NTP4Verif.NTP4Verif" "Why3STD.Ref_Ref" "Why3STD.map_Const" "Why3STD.map_MapEq" "mach.int_Unsigned" "mach.c_C" "../../lib/isabelle/lemmas_Lemmas" "../../lib/isabelle/types_Config" "../../lib/isabelle/types_Types" "../../lib/isabelle/types_Int32Eq" "../../lib/isabelle/types_UInt64Eq" "../../lib/isabelle/util_Util" "../../lib/isabelle/ptralias_Alias" "../../lib/isabelle/compare_Compare" "../../lib/isabelle/mpz_Z" "../../lib/isabelle/mpz_Zutil"
begin
definition alloc_of_bits :: "int \<Rightarrow> int"
  where "alloc_of_bits bits = (if bits \<le> (0 :: int) then 1 :: int else (bits + (63 :: int)) ediv (64 :: int))" for bits
theorem wmpz_realloc2'vc:
  fixes mpz :: "mpz_memo"
  fixes x :: "mpz_ptr"
  fixes bits :: "64 word"
  fixes o1 :: "64 word"
  assumes fact0: "readers mpz x = (0 :: int)"
  assumes fact1: "(uint bits - (1 :: int)) ediv (64 :: int) < (2147483647 :: int)"
  assumes fact2: "(1 :: int) \<le> alloc mpz x"
  assumes fact3: "uint bits = (0 :: int) \<longrightarrow> bits = (0 :: 64 word)"
  assumes fact4: "if \<not>bits = (0 :: 64 word) then o1 = (1 :: 64 word) else o1 = (0 :: 64 word)"
  shows "uint'64_in_bounds (uint bits - uint o1)"
  and "\<forall>(bits1 :: 64 word). uint bits1 = uint bits - uint o1 \<longrightarrow> (\<not>(64 :: int) = (0 :: int) \<and> uint'64_in_bounds (uint bits1 cdiv (64 :: int))) \<and> (\<forall>(o2 :: 64 word). uint o2 = uint bits1 cdiv (64 :: int) \<longrightarrow> uint'64_in_bounds ((1 :: int) + uint o2) \<and> (\<forall>(o3 :: 64 word). uint o3 = (1 :: int) + uint o2 \<longrightarrow> uint o3 \<le> (2147483647 :: int) \<and> (\<forall>(new_alloc :: 32 word). sint new_alloc = uint o3 \<longrightarrow> readers mpz x = (0 :: int) \<and> (\<forall>(mpz1 :: mpz_memo). abs_value_of mpz1 = abs_value_of mpz \<and> alloc mpz1 = alloc mpz \<and> abs_size mpz1 = abs_size mpz \<and> sgn mpz1 = sgn mpz \<and> zones mpz1 = zones mpz \<longrightarrow> (\<forall>(p :: 64 word ptr). readers mpz1 x = -(1 :: int) \<and> (\<forall>(y :: mpz_ptr). \<not>x = y \<longrightarrow> readers mpz1 y = readers mpz y) \<and> value p (abs_size mpz1 x) = abs_value_of mpz1 x \<and> plength p = alloc mpz1 x \<and> offset p = (0 :: int) \<and> c_C.min p = (0 :: int) \<and> c_C.max p = plength p \<and> writable p = True \<and> zone1 p = zones mpz1 x \<longrightarrow> -(2 :: int) < readers mpz1 x \<and> (\<forall>(os :: 32 word). sint os = abs_size mpz1 x \<longrightarrow> ((0 :: int) \<le> sint new_alloc \<and> offset p = (0 :: int) \<and> c_C.min p = (0 :: int) \<and> c_C.max p = plength p \<and> (0 :: int) < plength p \<and> writable p = True) \<and> (\<forall>(p1 :: 64 word ptr). offset p1 = offset p \<and> writable p1 = writable p \<and> zone1 p1 = zone1 p \<longrightarrow> (\<forall>(q :: 64 word ptr). writable q = True \<and> (\<not>zone1 q = null_zone \<longrightarrow> c_C.min q = (0 :: int)) \<and> (\<not>zone1 q = null_zone \<longrightarrow> c_C.max q = plength q) \<and> offset q = (0 :: int) \<and> (\<not>zone1 q = null_zone \<longrightarrow> plength q = sint new_alloc) \<and> (\<not>zone1 q = null_zone \<longrightarrow> (\<forall>(i :: int). ((0 :: int) \<le> i \<and> i < plength p) \<and> i < sint new_alloc \<longrightarrow> pelts q i = pelts p i)) \<and> (zone1 q = null_zone \<longrightarrow> p1 = p) \<longrightarrow> (is_not_null q \<longleftrightarrow> \<not>zone1 q = null_zone) \<longrightarrow> is_not_null q \<longrightarrow> -(2 :: int) < readers mpz1 x \<and> (\<forall>(o4 :: 32 word). sint o4 = abs_size mpz1 x \<longrightarrow> (if sint new_alloc < sint o4 then (-(1 :: int) \<le> readers mpz1 x \<and> readers mpz1 x \<le> (0 :: int)) \<and> (\<forall>(mpz2 :: mpz_memo). alloc mpz2 = alloc mpz1 \<and> sgn mpz2 = sgn mpz1 \<and> readers mpz2 = readers mpz1 \<and> zones mpz2 = zones mpz1 \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz2 mpz1) \<and> abs_size mpz2 x = (0 :: int) \<and> abs_value_of mpz2 x = (0 :: int) \<longrightarrow> (abs_size mpz2 x \<le> sint new_alloc \<and> -(1 :: int) \<le> readers mpz2 x \<and> readers mpz2 x \<le> (0 :: int)) \<and> (\<forall>(mpz3 :: mpz_memo). abs_value_of mpz3 = abs_value_of mpz2 \<and> abs_size mpz3 = abs_size mpz2 \<and> sgn mpz3 = sgn mpz2 \<and> readers mpz3 = readers mpz2 \<and> zones mpz3 = zones mpz2 \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz3 mpz2) \<and> alloc mpz3 x = sint new_alloc \<longrightarrow> (offset q = (0 :: int) \<and> writable q = True \<and> c_C.min q = (0 :: int) \<and> c_C.max q = plength q \<and> plength q = alloc mpz3 x \<and> (readers mpz3 x = (0 :: int) \<or> readers mpz3 x = -(1 :: int))) \<and> (\<forall>(mpz4 :: mpz_memo). alloc mpz4 = alloc mpz3 \<and> abs_size mpz4 = abs_size mpz3 \<and> sgn mpz4 = sgn mpz3 \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz4 mpz3) \<and> abs_value_of mpz4 x = value q (abs_size mpz4 x) \<and> readers mpz4 x = -(1 :: int) \<and> zones mpz4 x = zone1 q \<longrightarrow> (zones mpz4 x = zone1 q \<and> readers mpz4 x = -(1 :: int) \<and> c_C.min q = (0 :: int) \<and> c_C.max q = plength q \<and> abs_value_of mpz4 x = value q (abs_size mpz4 x)) \<and> (\<forall>(mpz5 :: mpz_memo). abs_value_of mpz5 = abs_value_of mpz4 \<and> alloc mpz5 = alloc mpz4 \<and> abs_size mpz5 = abs_size mpz4 \<and> sgn mpz5 = sgn mpz4 \<and> zones mpz5 = zones mpz4 \<longrightarrow> readers mpz5 x = (0 :: int) \<and> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> readers mpz5 y = readers mpz4 y) \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz5 mpz) \<and> readers mpz5 x = (0 :: int) \<and> alloc mpz5 x = alloc_of_bits (uint bits) \<and> (if abs_size mpz x \<le> alloc_of_bits (uint bits) then abs_size mpz5 x = abs_size mpz x \<and> abs_value_of mpz5 x = abs_value_of mpz x else abs_size mpz5 x = (0 :: int)))))) else (abs_size mpz1 x \<le> sint new_alloc \<and> -(1 :: int) \<le> readers mpz1 x \<and> readers mpz1 x \<le> (0 :: int)) \<and> (\<forall>(mpz2 :: mpz_memo). abs_value_of mpz2 = abs_value_of mpz1 \<and> abs_size mpz2 = abs_size mpz1 \<and> sgn mpz2 = sgn mpz1 \<and> readers mpz2 = readers mpz1 \<and> zones mpz2 = zones mpz1 \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz2 mpz1) \<and> alloc mpz2 x = sint new_alloc \<longrightarrow> (offset q = (0 :: int) \<and> writable q = True \<and> c_C.min q = (0 :: int) \<and> c_C.max q = plength q \<and> plength q = alloc mpz2 x \<and> (readers mpz2 x = (0 :: int) \<or> readers mpz2 x = -(1 :: int))) \<and> (\<forall>(mpz3 :: mpz_memo). alloc mpz3 = alloc mpz2 \<and> abs_size mpz3 = abs_size mpz2 \<and> sgn mpz3 = sgn mpz2 \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz3 mpz2) \<and> abs_value_of mpz3 x = value q (abs_size mpz3 x) \<and> readers mpz3 x = -(1 :: int) \<and> zones mpz3 x = zone1 q \<longrightarrow> (zones mpz3 x = zone1 q \<and> readers mpz3 x = -(1 :: int) \<and> c_C.min q = (0 :: int) \<and> c_C.max q = plength q \<and> abs_value_of mpz3 x = value q (abs_size mpz3 x)) \<and> (\<forall>(mpz4 :: mpz_memo). abs_value_of mpz4 = abs_value_of mpz3 \<and> alloc mpz4 = alloc mpz3 \<and> abs_size mpz4 = abs_size mpz3 \<and> sgn mpz4 = sgn mpz3 \<and> zones mpz4 = zones mpz3 \<longrightarrow> readers mpz4 x = (0 :: int) \<and> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> readers mpz4 y = readers mpz3 y) \<longrightarrow> (\<forall>(y :: mpz_ptr). \<not>y = x \<longrightarrow> mpz_unchanged y mpz4 mpz) \<and> readers mpz4 x = (0 :: int) \<and> alloc mpz4 x = alloc_of_bits (uint bits) \<and> (if abs_size mpz x \<le> alloc_of_bits (uint bits) then abs_size mpz4 x = abs_size mpz x \<and> abs_value_of mpz4 x = abs_value_of mpz x else abs_size mpz4 x = (0 :: int)))))))))))))))"
  sorry
end

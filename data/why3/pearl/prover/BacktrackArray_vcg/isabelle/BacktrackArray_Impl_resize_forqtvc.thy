theory BacktrackArray_Impl_resize_forqtvc
  imports "NTP4Verif.NTP4Verif" "../../lib/isabelle/BacktrackArray_Types" "../../lib/isabelle/Functions_Config" "../../lib/isabelle/Functions_Func" "../../lib/isabelle/Predicates_Pred" "../../lib/isabelle/BacktrackArray_Logic" "../../lib/isabelle/Choice_Choice"
begin
theorem resize_for'vc:
  fixes tb :: "'a t"
  fixes x :: "int"
  assumes fact0: "correct tb"
  assumes fact1: "int (length (buffer tb)) \<le> x"
  shows "let o1 :: 'a list list = buffer tb in \<forall>(o2 :: 'a list list). length o2 = length o1 \<and> (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < int (length o2) \<longrightarrow> o2 ! nat i = o1 ! nat i) \<longrightarrow> (let tbc :: 'a t = t'mk (history tb) (current_time tb) o2 (inv tb) in (\<forall>(tbc1 :: 'a t) (tb1 :: 'a t). inv tbc1 = inv tb \<longrightarrow> inv tb1 = inv tb \<longrightarrow> ((0 :: int) < int (length (buffer tbc1)) \<and> int (length (buffer tbc1)) \<le> x) \<and> correct tbc1 \<and> history tbc1 = history tb1 \<and> current_time tbc1 = current_time tb1 \<and> func_of_array (buffer tbc1) (Nil :: 'a list) = func_of_array (buffer tb1) (Nil :: 'a list) \<longrightarrow> (\<forall>(tb2 :: 'a t). buffer tb2 = buffer tb1 \<and> inv tb2 = inv tb1 \<longrightarrow> history tb2 = Cons (-(1 :: int)) (history tb1) \<and> current_time tb2 = current_time tb1 + (1 :: int) \<longrightarrow> (\<forall>(tbc2 :: 'a t). buffer tbc2 = buffer tbc1 \<and> inv tbc2 = inv tbc1 \<longrightarrow> history tbc2 = Cons (-(1 :: int)) (history tbc1) \<and> current_time tbc2 = current_time tbc1 + (1 :: int) \<longrightarrow> (let size2 :: int = (2 :: int) * int (length (buffer tbc1)) in (0 :: int) \<le> size2 \<and> (\<forall>(buf2 :: 'a list list). (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < size2 \<longrightarrow> buf2 ! nat i = (Nil :: 'a list)) \<and> int (length buf2) = size2 \<longrightarrow> (let buf1 :: 'a list list = buffer tbc2 in (((0 :: int) \<le> (0 :: int) \<and> (0 :: int) \<le> int (length (buffer tbc1)) \<and> (0 :: int) + int (length (buffer tbc1)) \<le> int (length buf1)) \<and> (0 :: int) \<le> (0 :: int) \<and> (0 :: int) + int (length (buffer tbc1)) \<le> int (length buf2)) \<and> (\<forall>(buf21 :: 'a list list). length buf21 = length buf2 \<longrightarrow> (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < (0 :: int) \<or> (0 :: int) + int (length (buffer tbc1)) \<le> i \<and> i < int (length buf21) \<longrightarrow> buf21 ! nat i = buf2 ! nat i) \<and> (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < (0 :: int) + int (length (buffer tbc1)) \<longrightarrow> buf21 ! nat i = buf1 ! nat ((0 :: int) + i - (0 :: int))) \<longrightarrow> (\<forall>(tbc3 :: 'a t). history tbc3 = history tbc2 \<and> current_time tbc3 = current_time tbc2 \<and> buffer tbc3 = buf21 \<and> inv tbc3 = inv tbc2 \<longrightarrow> (if x < size2 then correct tbc3 \<and> (history tbc3 = history tb2 \<and> current_time tbc3 = current_time tb2 \<and> func_of_array (buffer tbc3) (Nil :: 'a list) = func_of_array (buffer tb2) (Nil :: 'a list)) \<and> int (length (buffer tbc3)) = size2 \<and> x < size2 \<and> int (length (buffer tbc1)) \<le> size2 \<and> precede tbc1 tbc3 else (((0 :: int) \<le> x - int (length (buffer tbc1)) \<and> x - size2 < x - int (length (buffer tbc1))) \<and> ((0 :: int) < size2 \<and> size2 \<le> x) \<and> correct tbc3 \<and> (history tbc3 = history tb2 \<and> current_time tbc3 = current_time tb2 \<and> func_of_array (buffer tbc3) (Nil :: 'a list) = func_of_array (buffer tb2) (Nil :: 'a list)) \<and> int (length (buffer tbc3)) = size2) \<and> (\<forall>(tbc4 :: 'a t) (tb3 :: 'a t). inv tbc4 = inv tbc3 \<longrightarrow> buffer tb3 = buffer tb2 \<and> inv tb3 = inv tb2 \<longrightarrow> correct tbc4 \<and> (history tbc4 = history tb3 \<and> current_time tbc4 = current_time tb3 \<and> func_of_array (buffer tbc4) (Nil :: 'a list) = func_of_array (buffer tb3) (Nil :: 'a list)) \<and> x < int (length (buffer tbc4)) \<and> size2 \<le> int (length (buffer tbc4)) \<and> precede tbc3 tbc4 \<longrightarrow> correct tbc4 \<and> (history tbc4 = history tb3 \<and> current_time tbc4 = current_time tb3 \<and> func_of_array (buffer tbc4) (Nil :: 'a list) = func_of_array (buffer tb3) (Nil :: 'a list)) \<and> x < int (length (buffer tbc4)) \<and> length (buffer tbc1) \<le> length (buffer tbc4) \<and> precede tbc1 tbc4)))))))))) \<and> (let len :: int = int (length (buffer tb)) in (((0 :: int) < len \<and> len \<le> x) \<and> correct tbc \<and> func_of_array o2 (Nil :: 'a list) = func_of_array (buffer tb) (Nil :: 'a list) \<and> int (length o2) = len) \<and> (\<forall>(tbc1 :: 'a t) (tb1 :: 'a t). inv tbc1 = inv tb \<longrightarrow> buffer tb1 = buffer tb \<and> inv tb1 = inv tb \<longrightarrow> correct tbc1 \<and> (history tbc1 = history tb1 \<and> current_time tbc1 = current_time tb1 \<and> func_of_array (buffer tbc1) (Nil :: 'a list) = func_of_array (buffer tb1) (Nil :: 'a list)) \<and> x < int (length (buffer tbc1)) \<and> len \<le> int (length (buffer tbc1)) \<and> precede tbc tbc1 \<longrightarrow> (0 :: int) \<le> int (length (buffer tbc1)) \<and> (\<forall>(buf2 :: 'a list list). (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < int (length (buffer tbc1)) \<longrightarrow> buf2 ! nat i = (Nil :: 'a list)) \<and> length buf2 = length (buffer tbc1) \<longrightarrow> (let buf1 :: 'a list list = buffer tb1 in (((0 :: int) \<le> (0 :: int) \<and> (0 :: int) \<le> len \<and> (0 :: int) + len \<le> int (length buf1)) \<and> (0 :: int) \<le> (0 :: int) \<and> (0 :: int) + len \<le> int (length buf2)) \<and> (\<forall>(buf21 :: 'a list list). length buf21 = length buf2 \<longrightarrow> (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < (0 :: int) \<or> (0 :: int) + len \<le> i \<and> i < int (length buf21) \<longrightarrow> buf21 ! nat i = buf2 ! nat i) \<and> (\<forall>(i :: int). (0 :: int) \<le> i \<and> i < (0 :: int) + len \<longrightarrow> buf21 ! nat i = buf1 ! nat ((0 :: int) + i - (0 :: int))) \<longrightarrow> (\<forall>(tb2 :: 'a t). history tb2 = history tb1 \<and> current_time tb2 = current_time tb1 \<and> buffer tb2 = buf21 \<and> inv tb2 = inv tb1 \<longrightarrow> x < int (length (buffer tb2)) \<and> precede tb tb2 \<and> correct tb2 \<and> table (current_timestamp tb2) = table (current_timestamp tb))))))))"
  sorry
end
